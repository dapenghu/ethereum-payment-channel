## 去信任的清算协议，以及在现代支付清算结算系统的应用 - 从闪电网络谈起

## 1 闪电网络的简介和现状
闪电网络(Lightning Network)最初是由 Joseph Poon 和 Thaddeus Dryja 在2015年的白皮书中提出的。这篇白皮书在比特币社区中产生了很大反响，在众多关于比特币的研究论文和白皮书中，被认为是第二重要的，其价值仅次于中本聪的创世论文。

由于闪电网络依赖于隔离验证，在2017年比特币隔离验证升级之前，一直停留在概念和内部开发阶段。2018年3月，Lightning Labs 开发并推出了第一个测试版，之后 ACINQ 和 Blockstream 两家公司也相继推出了不同的实现。从此以后闪电网络的发展就步入正轨。根据 [统计网站](https://1ml.com/statistics) 的数据，闪电网络目前有 6,761 个节点，30,622 个支付通道，支付通道总计有 729.89 BTC(约281万美金)。说明闪电网络在过去的一年中取得了显著增长。

闪电网络的愿景是解决比特币网络的扩容问题。众所周知，比特币的初衷是实现一个端到端的电子现金系统，为全世界提供一个去信任的、7x24小时服务的电子支付网络。但是比特币的性能却远远达不到要求。按照平均每个交易300字节计算，比特币的平均吞吐量是 5.6 TPS。然而 [Visa](https://www.visa.com/blogarchives/us/2013/10/10/stress-test-prepares-visanet-for-the-most-wonderful-time-of-the-year/index.html) 的峰值吞吐量可以达到 47000 TPS。如果对标这个吞吐量，比特币的区块大小要扩张到 8GB 左右，每年要新增 400 TB的区块数据。这显然是不现实的。

除了闪电网络，比特币社区同时也提出了众多的扩容解决方案，比如大区块、DPoS、DAG、分片、侧链、跨链等方案，这些方案都是试图修改比特币协议本身，例如调整配置参数、优化数据结构、修改共识算法、账本分区处理、优化网络资源管理等等。但是效果都不好，在付出了高昂的代价(存储成本增加、流量成本增加、复杂度增加、弱化去中心化)之后，却只是获得了非常有限的性能提升，和 Visa 相比依然还有几个数量级的差距。唯有闪电网络脑洞大开、另辟蹊径，使用了新的价值转移范式，在比特币的智能合约基础上，结合链下去信任的清算协议，构建了二层支付系统。彻底摆脱了“去中心化-安全-性能”的三元悖论约束，将系统的吞吐量上限提升到了几十万 TPS 级别，同时可以做到类似于支付宝、微信支付的实时支付体验。而且难能可贵的是，它对比特币网络本身几乎没有带来任何负面影响。

闪电网络的技术并不包含类似于零知识证明那样的高难度技术，但是它的巧妙设计依然令白皮书晦涩难读。市面上也缺乏简单易读而且讲解透彻的科普文章，对于广大金融科技与区块链爱好者和投资者来讲，有很高的学习门槛。所以闪电网络技术的价值长期被误解、被低估。本文重新梳理了闪电网络的思想，用通俗易懂的文字，为大家介绍闪电网络的技术原理，总结技术优势和劣势，研究它的适用的场景，最终分析它在现代电子支付系统中的潜在应用价值。希望能帮助广大读者更深入的认知闪电网络。

此文的章节结构如下：

- 第二节从金融的角度，介绍两种不同的价值转移范式，找出闪电网络的创新思路；
- 第三节详细介绍闪电网络的技术原理：如何使用链上智能合约、配合链下密码学协议实现去信任的债务清算；
- 第四节分析闪电网络技术的优点，解释为什么交易延时可以达到实时支付？为什么吞吐量的理论上限可以达到几十万TPS？应用闪电网络有哪些限定条件?
- 第五节介绍闪电网络还有哪些缺点？在哪些方面还有可以改进、可以拓展的空间？
- 第六节结合现代电子支付、清算、结算系统，讨论闪电网络的应用前景；
- 第七节总结闪电网络技术对于区块链和金融科技的价值和意义。

## 2. 价值转移的范式：所有权交割与债权清算
闪电网络的实现包含智能合约与密码学协议，技术细节比较复杂。为了便于读者理解，我们先从货币银行学的角度解释比特币的扩容为什么那么难？阐述闪电网络的思路，

区块链的通信基于 Gossip 协议，每一个交易信息都要广播给所有的网络参与方。

While it is possible to scale at a small level, it is absolutely not possible to handle a large amount of micropayments on the network or to encompass all global transactions.

虽然在工程上有各种技术手段可以小规模的提升比特币的性能，但是要达到类似 Visa 的吞吐量是不现实的。

Currently the solution to micropayments and scalability is to offoad the transactions to a custodian, whereby one is trusting third party custodians to hold one’s coins and to update balances with other parties. Trusting third parties to hold all of one’s funds creates counterparty risk and transaction costs。

现代的微支付和可扩容性是由一个可信的第三方托管人处理交易，由他保管资产并且调整资产负债表。托管人会产生交易成本和交易对手风险。

忠诚保险

## 3. 技术详解：去信任的清算协议

## 4. 技术优势和劣势分析

## 5. 技术的进一步拓展

## 6. 现代支付清算结算系统与应用

## 7. 总结

## Reference
- Joseph Poon,Thaddeus Dryja, [The Bitcoin Lightning Network: Scalable Off-Chain Instant Payments](https://lightning.network/lightning-network-paper.pdf)

- [闪电统计](https://1ml.com/statistics)

- [闪电网络工作原理](https://cointelegraph.com/lightning-network-101/what-is-lightning-network-and-how-it-works#what-is-the-lightning-network)， [中文翻译](https://mp.weixin.qq.com/s/9VP_W_sH8fDRdOvPBaUwwQ)

- [BitMEX：从中期来看，闪电网络不会带来什么大变革](https://www.ccvalue.cn/show/1577)

- [简述闪电网络历史：一个与比特币同样伟大想法的历程](https://mp.weixin.qq.com/s/P0X6kGLdrzEmZqzq3jktrw)

- [闪电网络如何工作](https://mp.weixin.qq.com/s/aslEUaNvpi3nVUv045Bv-Q) [英文原文](https://coincentral.com/lightning-network-beginners-guide/)

- [社群对闪电网络的看法](https://mp.weixin.qq.com/s/X_DpRFPUKO7H0vEn4XnVwg)

- [The growth of the Lightning Network](https://www.theblockcrypto.com/2019/01/15/the-growth-of-the-lightning-network-has-been-remarkable-but-theres-a-catch/)

- 闪电网络白皮书

